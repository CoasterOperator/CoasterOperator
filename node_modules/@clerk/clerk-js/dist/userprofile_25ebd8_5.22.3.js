"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([[45],{4994:function(e,t,o){o.r(t),o.d(t,{UserProfile:function(){return at},UserProfileModal:function(){return lt}});var r=o(4380),i=o(4041),n=o(844),s=o(9333),a=o(338),l=o(166),c=o(9513);const d=e=>{const{pages:t}=(0,n.useUserProfileContext)();return(0,r.FD)(a.NavbarContextProvider,{children:[(0,r.Y)(a.NavBar,{title:(0,c.GQ)("userProfile.navbar.title"),description:(0,c.GQ)("userProfile.navbar.description"),routes:t.routes,contentRef:e.contentRef}),e.children]})};var u=o(9834),m=o(2237),f=o(3931),h=o(4870),p=o(7362),v=o(3090),P=o(2572),g=o(5909),y=o(9927);const Y=()=>{const e=(0,a.useCardState)(),{user:t}=(0,f.Jd)(),{navigate:o}=(0,l.useRouter)(),{strategies:i,strategyToDisplayData:c}=(0,g.kF)(),{additionalOAuthScopes:d,componentName:u,mode:m}=(0,n.useUserProfileContext)(),v="modal"===m,P=i.filter((e=>e.startsWith("oauth"))),Y=null==t?void 0:t.verifiedExternalAccounts.map((e=>`oauth_${e.provider}`)),b=P.filter((e=>!Y.includes(e)));return 0===b.length?null:(0,r.Y)(a.ProfileSection.ActionMenu,{triggerLocalizationKey:(0,s.localizationKeys)("userProfile.start.connectedAccountsSection.primaryButton"),id:"connectedAccounts",children:b.map((i=>{const n=c[i].iconUrl?(0,r.Y)(s.Image,{isLoading:e.loadingMetadata===i,isDisabled:e.isLoading,elementDescriptor:s.descriptors.providerIcon,elementId:s.descriptors.providerIcon.setId(c[i].id),src:c[i].iconUrl,alt:`Connect ${c[i].name} account`,sx:e=>({width:e.sizes.$4})}):(0,r.Y)(p.Tr,{id:c[i].id,value:c[i].name,isLoading:e.loadingMetadata===i,isDisabled:e.isLoading});return(0,r.Y)(a.ProfileSection.ActionMenuItem,{id:c[i].id,onClick:()=>(r=>{const i=r.replace("oauth_",""),n=v?(0,h.jk)({url:window.location.href,componentName:u,socialProvider:i}):window.location.href,s=d?d[i]:[];e.setLoading(r),null==t||t.createExternalAccount({strategy:r,redirectUrl:n,additionalScopes:s}).then((t=>{var i;(null===(i=t.verification)||void 0===i?void 0:i.externalVerificationRedirectURL)&&((0,y.yy)(2e3).then((()=>e.setIdle(r))),o(t.verification.externalVerificationRedirectURL.href))})).catch((t=>{(0,y.H4)(t,[],e.setError),e.setIdle(r)}))})(i),isDisabled:e.isLoading,variant:"ghost",isLoading:e.loadingMetadata===i,focusRing:!1,closeAfterClick:!1,localizationKey:(0,s.localizationKeys)("userProfile.connectedAccountPage.socialButtonsBlockButton",{provider:c[i].name}),sx:e=>({justifyContent:"start",gap:e.space.$2}),leftIcon:n},i)}))})},b=e=>{var t;const{onSuccess:o,onReset:n}=e,{user:a}=(0,f.Jd)(),{emailId:l}=e,c=null==a?void 0:a.emailAddresses.find((e=>e.id===l)),d=i.useRef(null==c?void 0:c.emailAddress),u="verified"===(null===(t=null==c?void 0:c.verification)||void 0===t?void 0:t.status)?(0,s.localizationKeys)("userProfile.emailAddressPage.removeResource.messageLine2"):void 0;return d.current?(0,r.Y)(p.P_,{title:(0,s.localizationKeys)("userProfile.emailAddressPage.removeResource.title"),messageLine1:(0,s.localizationKeys)("userProfile.emailAddressPage.removeResource.messageLine1",{identifier:d.current}),messageLine2:u,successMessage:(0,s.localizationKeys)("userProfile.emailAddressPage.removeResource.successMessage",{emailAddress:d.current}),deleteResource:()=>Promise.resolve(null==c?void 0:c.destroy()),onSuccess:o,onReset:n}):null},S=e=>{var t;const{phoneId:o,onSuccess:n,onReset:a}=e,{user:l}=(0,f.Jd)(),c=null==l?void 0:l.phoneNumbers.find((e=>e.id===o)),d=i.useRef(null==c?void 0:c.phoneNumber),u="verified"===(null===(t=null==c?void 0:c.verification)||void 0===t?void 0:t.status)?(0,s.localizationKeys)("userProfile.phoneNumberPage.removeResource.messageLine2"):void 0;return d.current?(0,r.Y)(p.P_,{title:(0,s.localizationKeys)("userProfile.phoneNumberPage.removeResource.title"),messageLine1:(0,s.localizationKeys)("userProfile.phoneNumberPage.removeResource.messageLine1",{identifier:d.current}),messageLine2:u,successMessage:(0,s.localizationKeys)("userProfile.phoneNumberPage.removeResource.successMessage",{phoneNumber:d.current}),deleteResource:()=>Promise.resolve(null==c?void 0:c.destroy()),onSuccess:n,onReset:a}):null},z=e=>{var t,o;const{accountId:n,onSuccess:a,onReset:l}=e,{user:c}=(0,f.Jd)(),d=null==c?void 0:c.externalAccounts.find((e=>e.id===n)),u=i.useRef(null==d?void 0:d.provider),{providerToDisplayData:m}=(0,g.kF)();return u.current?(0,r.Y)(p.P_,{title:(0,s.localizationKeys)("userProfile.connectedAccountPage.removeResource.title"),messageLine1:(0,s.localizationKeys)("userProfile.connectedAccountPage.removeResource.messageLine1",{identifier:null===(t=m[u.current])||void 0===t?void 0:t.name}),messageLine2:(0,s.localizationKeys)("userProfile.connectedAccountPage.removeResource.messageLine2"),successMessage:(0,s.localizationKeys)("userProfile.connectedAccountPage.removeResource.successMessage",{connectedAccount:null===(o=m[u.current])||void 0===o?void 0:o.name}),deleteResource:()=>Promise.resolve(null==d?void 0:d.destroy()),onSuccess:a,onReset:l}):null},C=e=>{var t;const{user:o}=(0,f.Jd)(),{walletId:n,onSuccess:a,onReset:l}=e,c=null==o?void 0:o.web3Wallets.find((e=>e.id===n)),d=i.useRef(null==c?void 0:c.web3Wallet),u="verified"===(null===(t=null==c?void 0:c.verification)||void 0===t?void 0:t.status)?(0,s.localizationKeys)("userProfile.web3WalletPage.removeResource.messageLine2"):void 0;return d.current?(0,r.Y)(p.P_,{title:(0,s.localizationKeys)("userProfile.web3WalletPage.removeResource.title"),messageLine1:(0,s.localizationKeys)("userProfile.web3WalletPage.removeResource.messageLine1",{identifier:d.current}),messageLine2:u,successMessage:(0,s.localizationKeys)("userProfile.web3WalletPage.removeResource.successMessage",{web3Wallet:d.current}),deleteResource:()=>Promise.resolve(null==c?void 0:c.destroy()),onSuccess:a,onReset:l}):null},F=e=>{const{user:t}=(0,f.Jd)(),{phoneId:o,onSuccess:n,onReset:a}=e,l=null==t?void 0:t.phoneNumbers.find((e=>e.id===o)),c=i.useRef(null==l?void 0:l.phoneNumber);return c.current?(0,r.Y)(p.P_,{title:(0,s.localizationKeys)("userProfile.mfaPhoneCodePage.removeResource.title"),messageLine1:(0,s.localizationKeys)("userProfile.mfaPhoneCodePage.removeResource.messageLine1",{identifier:c.current}),messageLine2:(0,s.localizationKeys)("userProfile.mfaPhoneCodePage.removeResource.messageLine2"),successMessage:(0,s.localizationKeys)("userProfile.mfaPhoneCodePage.removeResource.successMessage",{mfaPhoneCode:c.current}),deleteResource:()=>Promise.resolve(null==l?void 0:l.setReservedForSecondFactor({reserved:!1})),onSuccess:n,onReset:a}):null},K=e=>{const{onSuccess:t,onReset:o}=e,{user:i}=(0,f.Jd)();return i?(0,r.Y)(p.P_,{title:(0,s.localizationKeys)("userProfile.mfaTOTPPage.removeResource.title"),messageLine1:(0,s.localizationKeys)("userProfile.mfaTOTPPage.removeResource.messageLine1"),messageLine2:(0,s.localizationKeys)("userProfile.mfaTOTPPage.removeResource.messageLine2"),successMessage:(0,s.localizationKeys)("userProfile.mfaTOTPPage.removeResource.successMessage"),deleteResource:i.disableTOTP,onSuccess:t,onReset:o}):null},R=e=>{const{onSuccess:t,onReset:o,passkey:i}=e;return(0,r.Y)(p.P_,{title:(0,s.localizationKeys)("userProfile.passkeyScreen.removeResource.title"),messageLine1:(0,s.localizationKeys)("userProfile.passkeyScreen.removeResource.messageLine1",{name:i.name}),deleteResource:i.delete,onSuccess:t,onReset:o})},D=e=>{const{close:t}=(0,P.D5)();return(0,r.Y)(z,{onSuccess:t,onReset:t,...e})},x=["external_account_missing_refresh_token","oauth_fetch_user_error","oauth_token_exchange_error","external_account_email_address_verification_required"],_=(0,a.withCardStateProvider)((()=>{const{user:e}=(0,f.Jd)(),t=(0,a.useCardState)();if(!e)return null;const o=[...e.verifiedExternalAccounts,...e.unverifiedExternalAccounts.filter((e=>{var t;return null===(t=e.verification)||void 0===t?void 0:t.error}))];return(0,r.FD)(a.ProfileSection.Root,{title:(0,s.localizationKeys)("userProfile.start.connectedAccountsSection.title"),centered:!1,id:"connectedAccounts",children:[(0,r.Y)(a.Card.Alert,{children:t.error}),(0,r.FD)(v.r.Root,{children:[(0,r.Y)(a.ProfileSection.ItemList,{id:"connectedAccounts",children:o.map((e=>(0,r.Y)(w,{account:e},e.id)))}),(0,r.Y)(Y,{})]})]})})),w=({account:e})=>{var t,o,i,c,d,u;const{additionalOAuthScopes:m,componentName:P,mode:Y}=(0,n.useUserProfileContext)(),{navigate:b}=(0,l.useRouter)(),{user:S}=(0,f.Jd)(),z=(0,a.useCardState)();if(!S)return null;const C="modal"===Y,{providerToDisplayData:F}=(0,g.kF)(),K=e.username||e.emailAddress,R=null===(o=null===(t=e.verification)||void 0===t?void 0:t.error)||void 0===o?void 0:o.longMessage,_=function(e,t){if(!t)return[];const o=t[e.provider]||[],r=e.approvedScopes.split(" ");return 0===o.filter((e=>!r.includes(e))).length?[]:o}(e,m),w=_.length>0&&""!=e.approvedScopes,k=x.includes((null===(c=null===(i=e.verification)||void 0===i?void 0:i.error)||void 0===c?void 0:c.code)||"")||w,I=k?(0,s.localizationKeys)("userProfile.start.connectedAccountsSection.subtitle__disconnected"):R;return(0,r.FD)(v.r.Root,{children:[(0,r.FD)(a.ProfileSection.Item,{id:"connectedAccounts",children:[(0,r.FD)(s.Flex,{sx:e=>({overflow:"hidden",gap:e.space.$2}),children:[(0,r.Y)((()=>F[e.provider].iconUrl?(0,r.Y)(s.Image,{elementDescriptor:[s.descriptors.providerIcon],elementId:s.descriptors.socialButtonsProviderIcon.setId(e.provider),alt:F[e.provider].name,src:F[e.provider].iconUrl,sx:e=>({width:e.sizes.$4,flexShrink:0})}):(0,r.Y)(p.Tr,{id:e.provider,value:F[e.provider].name})),{}),(0,r.Y)(s.Box,{sx:{whiteSpace:"nowrap",overflow:"hidden"},children:(0,r.FD)(s.Flex,{gap:2,center:!0,children:[(0,r.Y)(s.Text,{sx:e=>({color:e.colors.$colorText}),children:`${F[e.provider].name}`}),(0,r.Y)(s.Text,{truncate:!0,as:"span",colorScheme:"secondary",children:K?`â€¢ ${K}`:""})]})})]}),(0,r.Y)(T,{})]}),k&&(0,r.FD)(s.Box,{sx:e=>({padding:`${e.sizes.$none} ${e.sizes.$none} ${e.sizes.$1x5} ${e.sizes.$8x5}`}),children:[(0,r.Y)(s.Text,{colorScheme:"secondary",sx:e=>({paddingRight:e.sizes.$1x5,display:"inline-block"}),localizationKey:I}),(0,r.Y)(s.Button,{sx:{display:"inline-block"},onClick:async()=>{var t;const o=C?(0,h.jk)({url:window.location.href,componentName:P}):window.location.href;try{let r;r=w?await e.reauthorize({additionalScopes:_,redirectUrl:o}):await S.createExternalAccount({strategy:e.verification.strategy,redirectUrl:o,additionalScopes:_}),await b((null===(t=r.verification.externalVerificationRedirectURL)||void 0===t?void 0:t.href)||"")}catch(r){(0,y.H4)(r,[],z.setError)}},variant:"link",localizationKey:(0,s.localizationKeys)("userProfile.start.connectedAccountsSection.actionLabel__connectionFailed")})]}),(null===(u=null===(d=e.verification)||void 0===d?void 0:d.error)||void 0===u?void 0:u.code)&&!k&&(0,r.Y)(s.Text,{colorScheme:"danger",sx:e=>({padding:`${e.sizes.$none} ${e.sizes.$1x5} ${e.sizes.$1x5} ${e.sizes.$8x5}`}),children:R}),(0,r.Y)(v.r.Open,{value:"remove",children:(0,r.Y)(v.r.Card,{variant:"destructive",children:(0,r.Y)(D,{accountId:e.id})})})]},e.id)},T=()=>{const{open:e}=(0,P.D5)(),t=[{label:(0,s.localizationKeys)("userProfile.start.connectedAccountsSection.destructiveActionTitle"),isDestructive:!0,onClick:()=>e("remove")}].filter((e=>null!==e));return(0,r.Y)(a.ThreeDotsMenu,{actions:t})},k=e=>e.defaultSecondFactor?-1:1;function I(e){const t=[];return Object.entries(e).forEach((([,e])=>{e.used_for_second_factor&&t.push(...e.second_factors)})),t}function A(e,t){let o=I(e);return t.totpEnabled&&(o=o.filter((e=>"totp"!==e))),!t.backupCodeEnabled&&t.twoFactorEnabled||(o=o.filter((e=>"backup_code"!==e))),o}function B(e,t){if(!e)return[];const o=e.filter((e=>e.id===t)),r=e.filter((e=>e.id!==t)),i=r.filter((e=>{var t;return"verified"===(null===(t=e.verification)||void 0===t?void 0:t.status)})),n=r.filter((e=>{var t,o;return!!(null===(t=e.verification)||void 0===t?void 0:t.status)&&"verified"!==(null===(o=e.verification)||void 0===o?void 0:o.status)})),s=r.filter((e=>!e.verification.status));return i.sort(((e,t)=>e.id.localeCompare(t.id))),n.sort(((e,t)=>{var o,r;return(null===(o=e.verification)||void 0===o?void 0:o.expireAt)&&(null===(r=t.verification)||void 0===r?void 0:r.expireAt)?e.verification.expireAt.getTime()-t.verification.expireAt.getTime():0})),[...o,...i,...n,...s]}const L=e=>{const t=(0,a.useCardState)(),{nextStep:o,identification:n,identifier:l,onReset:c,prepareVerification:d}=e,u=()=>{var e;return null===(e=null==d?void 0:d())||void 0===e?void 0:e.catch((e=>(0,y.H4)(e,[],t.setError)))},m=(0,a.useFieldOTP)({onCodeEntryFinished:(e,t,o)=>{null==n||n.attemptVerification({code:e}).then((()=>t())).catch(o)},onResendCodeClicked:u,onResolve:o});return i.useEffect((()=>{u()}),[]),(0,r.FD)(r.FK,{children:[(0,r.Y)(a.Form.OTPInput,{...m,label:(0,s.localizationKeys)("userProfile.emailAddressPage.emailCode.formTitle"),description:(0,s.localizationKeys)("userProfile.emailAddressPage.emailCode.formSubtitle",{identifier:l}),resendButton:(0,s.localizationKeys)("userProfile.emailAddressPage.emailCode.resendButton"),centerAlign:!1}),(0,r.FD)(a.FormButtonContainer,{children:[(0,r.Y)(s.Button,{isLoading:m.isLoading,localizationKey:(0,s.localizationKeys)("formButtonPrimary__verify"),elementDescriptor:s.descriptors.formButtonPrimary,onClick:m.onFakeContinue}),(0,r.Y)(s.Button,{variant:"ghost",isDisabled:m.isLoading,localizationKey:(0,s.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:s.descriptors.formButtonReset,onClick:c})]})]})};var $=o(7453);const E=e=>{const{email:t,nextStep:o,onReset:l}=e,c=(0,a.useCardState)(),d=(0,n.useUserProfileContext)(),{startEmailLinkFlow:u}=(0,g.ui)(t),{displayConfig:m}=(0,n.useEnvironment)();function f(){const{routing:e}=d,t="virtual"===e?m.userProfileUrl:"",r=(0,$.W)(d,t);u({redirectUrl:r}).then((()=>o())).catch((e=>(0,y.H4)(e,[],c.setError)))}return i.useEffect((()=>{f()}),[]),(0,r.FD)(r.FK,{children:[(0,r.Y)(a.VerificationLink,{resendButton:(0,s.localizationKeys)("userProfile.emailAddressPage.emailLink.resendButton"),onResendCodeClicked:f}),(0,r.Y)(a.FormButtonContainer,{children:(0,r.Y)(s.Button,{variant:"ghost",localizationKey:(0,s.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:s.descriptors.formButtonReset,onClick:l})})]})},N=()=>(0,r.Y)(p.$W,{title:(0,s.localizationKeys)("signUp.emailLink.verifiedSwitchTab.title"),subtitle:(0,s.localizationKeys)("signUp.emailLink.verifiedSwitchTab.subtitle"),status:"verified"}),O=(0,a.withCardStateProvider)((e=>{var t,o,l;const{emailId:c,onSuccess:d,onReset:u}=e,m=(0,a.useCardState)(),{user:h}=(0,f.Jd)(),v=function(e){const{userSettings:t}=e,{email_address:o}=t.attributes;return o.enabled&&o.verifications.includes("email_link")}((0,n.useEnvironment)()),P=i.useRef(null==h?void 0:h.emailAddresses.find((e=>e.id===c))),g=(0,p.Xi)({defaultStep:P.current?1:0,onNextStep:()=>m.setError(void 0)}),Y=(0,y.tJ)("emailAddress","",{type:"email",label:(0,s.localizationKeys)("formFieldLabel__emailAddress"),placeholder:(0,s.localizationKeys)("formFieldInputPlaceholder__emailAddress"),isRequired:!0}),b=Y.value.length>1&&(null==h?void 0:h.username)!==Y.value;return(0,r.FD)(p.sQ,{...g.props,children:[(0,r.Y)(a.FormContainer,{headerTitle:(0,s.localizationKeys)("userProfile.emailAddressPage.title"),headerSubtitle:v?(0,s.localizationKeys)("userProfile.emailAddressPage.emailLink.formHint"):(0,s.localizationKeys)("userProfile.emailAddressPage.emailCode.formHint"),children:(0,r.FD)(a.Form.Root,{onSubmit:async e=>(e.preventDefault(),null==h?void 0:h.createEmailAddress({email:Y.value}).then((e=>{P.current=e,g.nextStep()})).catch((e=>(0,y.H4)(e,[Y],m.setError)))),children:[(0,r.Y)(a.Form.ControlRow,{elementId:Y.id,children:(0,r.Y)(a.Form.PlainInput,{...Y.props,autoFocus:!0})}),(0,r.Y)(a.FormButtons,{submitLabel:(0,s.localizationKeys)("userProfile.formButtonPrimary__add"),isDisabled:!b,onReset:u})]})}),(0,r.Y)(a.FormContainer,{headerTitle:(0,s.localizationKeys)("userProfile.emailAddressPage.verifyTitle"),headerSubtitle:v?(0,s.localizationKeys)("userProfile.emailAddressPage.emailLink.formSubtitle",{identifier:null===(t=P.current)||void 0===t?void 0:t.emailAddress}):(0,s.localizationKeys)("userProfile.emailAddressPage.emailCode.formSubtitle",{identifier:null===(o=P.current)||void 0===o?void 0:o.emailAddress}),children:v?(0,r.Y)(E,{nextStep:d,email:P.current,onReset:u}):(0,r.Y)(L,{nextStep:d,identification:P.current,identifier:null===(l=P.current)||void 0===l?void 0:l.emailAddress,prepareVerification:()=>{var e;return null===(e=P.current)||void 0===e?void 0:e.prepareVerification({strategy:"email_code"})},onReset:u})})]})})),M=e=>{const{close:t}=(0,P.D5)();return(0,r.Y)(b,{onSuccess:t,onReset:t,...e})},J=e=>{const{close:t}=(0,P.D5)();return(0,r.Y)(O,{onSuccess:t,onReset:t,...e})},U=()=>{const{user:e}=(0,f.Jd)();return(0,r.Y)(a.ProfileSection.Root,{title:(0,s.localizationKeys)("userProfile.start.emailAddressesSection.title"),centered:!1,id:"emailAddresses",children:(0,r.Y)(v.r.Root,{children:(0,r.FD)(a.ProfileSection.ItemList,{id:"emailAddresses",children:[B(null==e?void 0:e.emailAddresses,null==e?void 0:e.primaryEmailAddressId).map((t=>(0,r.FD)(v.r.Root,{children:[(0,r.FD)(a.ProfileSection.Item,{id:"emailAddresses",children:[(0,r.FD)(s.Flex,{sx:e=>({overflow:"hidden",gap:e.space.$1}),children:[(0,r.Y)(s.Text,{sx:e=>({color:e.colors.$colorText}),truncate:!0,children:t.emailAddress}),(null==e?void 0:e.primaryEmailAddressId)===t.id&&(0,r.Y)(s.Badge,{localizationKey:(0,s.localizationKeys)("badge__primary")}),"verified"!==t.verification.status&&(0,r.Y)(s.Badge,{localizationKey:(0,s.localizationKeys)("badge__unverified")})]}),(0,r.Y)(W,{email:t})]}),(0,r.Y)(v.r.Open,{value:"remove",children:(0,r.Y)(v.r.Card,{variant:"destructive",children:(0,r.Y)(M,{emailId:t.id})})}),(0,r.Y)(v.r.Open,{value:"verify",children:(0,r.Y)(v.r.Card,{children:(0,r.Y)(J,{emailId:t.id})})})]},t.emailAddress))),(0,r.Y)(v.r.Trigger,{value:"add",children:(0,r.Y)(a.ProfileSection.ArrowButton,{id:"emailAddresses",localizationKey:(0,s.localizationKeys)("userProfile.start.emailAddressesSection.primaryButton")})}),(0,r.Y)(v.r.Open,{value:"add",children:(0,r.Y)(v.r.Card,{children:(0,r.Y)(J,{})})})]})})})},W=({email:e})=>{const t=(0,a.useCardState)(),{user:o}=(0,f.Jd)(),{open:i}=(0,P.D5)(),n=(null==o?void 0:o.primaryEmailAddressId)===e.id,l="verified"===e.verification.status,c=[n&&!l?{label:(0,s.localizationKeys)("userProfile.start.emailAddressesSection.detailsAction__primary"),onClick:()=>i("verify")}:null,!n&&l?{label:(0,s.localizationKeys)("userProfile.start.emailAddressesSection.detailsAction__nonPrimary"),onClick:()=>null==o?void 0:o.update({primaryEmailAddressId:e.id}).catch((e=>(0,y.H4)(e,[],t.setError)))}:null,n||l?null:{label:(0,s.localizationKeys)("userProfile.start.emailAddressesSection.detailsAction__unverified"),onClick:()=>i("verify")},{label:(0,s.localizationKeys)("userProfile.start.emailAddressesSection.destructiveAction"),isDestructive:!0,onClick:()=>i("remove")}].filter((e=>null!==e));return(0,r.Y)(a.ThreeDotsMenu,{actions:c})},H=()=>{const{user:e}=(0,f.Jd)(),{getSamlProviderLogoUrl:t,getSamlProviderName:o}=(0,g.jn)();return(0,r.Y)(a.ProfileSection.Root,{title:(0,s.localizationKeys)("userProfile.start.enterpriseAccountsSection.title"),id:"enterpriseAccounts",centered:!1,children:(0,r.Y)(a.ProfileSection.ItemList,{id:"enterpriseAccounts",children:null==e?void 0:e.samlAccounts.map((e=>{var i,n;const l=e.emailAddress,c=o(e.provider),d=t(e.provider),u=null===(n=null===(i=e.verification)||void 0===i?void 0:i.error)||void 0===n?void 0:n.longMessage;return(0,r.FD)(a.ProfileSection.Item,{id:"enterpriseAccounts",sx:e=>({gap:e.space.$2,justifyContent:"start"}),children:[(0,r.Y)(s.Image,{elementDescriptor:[s.descriptors.providerIcon],elementId:s.descriptors.enterpriseButtonsProviderIcon.setId(e.provider),alt:c,src:d,sx:e=>({width:e.sizes.$4})}),(0,r.Y)(s.Box,{sx:{whiteSpace:"nowrap",overflow:"hidden"},children:(0,r.FD)(s.Flex,{gap:2,center:!0,children:[(0,r.Y)(s.Text,{truncate:!0,colorScheme:"body",children:c}),(0,r.Y)(s.Text,{truncate:!0,as:"span",colorScheme:"secondary",children:l?`â€¢ ${l}`:""}),u&&(0,r.Y)(s.Badge,{colorScheme:"danger",localizationKey:(0,s.localizationKeys)("badge__requiresAction")})]})})]},e.id)}))})})},q=(0,a.withCardStateProvider)((e=>{const{phoneId:t,onSuccess:o,onReset:n}=e,{user:a}=(0,f.Jd)(),l=i.useRef(null==a?void 0:a.phoneNumbers.find((e=>e.id===t))),c=(0,p.Xi)({defaultStep:l.current?1:0});return(0,r.FD)(p.sQ,{...c.props,children:[(0,r.Y)(V,{resourceRef:l,title:(0,s.localizationKeys)("userProfile.phoneNumberPage.title"),onSuccess:c.nextStep,onReset:n}),(0,r.Y)(j,{resourceRef:l,title:(0,s.localizationKeys)("userProfile.phoneNumberPage.verifyTitle"),onSuccess:o,onReset:n})]})})),V=e=>{var t;const{title:o,onSuccess:i,onReset:n,onUseExistingNumberClick:l,resourceRef:c}=e,d=(0,a.useCardState)(),{user:u}=(0,f.Jd)(),m=(0,y.tJ)("phoneNumber","",{type:"tel",label:(0,s.localizationKeys)("formFieldLabel__phoneNumber"),isRequired:!0}),h=m.value.length>1&&(null==u?void 0:u.username)!==m.value,p=!!(null===(t=null==u?void 0:u.phoneNumbers)||void 0===t?void 0:t.length)&&l;return(0,r.Y)(a.FormContainer,{headerTitle:o,gap:1,children:(0,r.FD)(a.Form.Root,{gap:4,onSubmit:async e=>(e.preventDefault(),null==u?void 0:u.createPhoneNumber({phoneNumber:m.value}).then((e=>{c.current=e,i()})).catch((e=>(0,y.H4)(e,[m],d.setError)))),children:[(0,r.Y)(s.Text,{localizationKey:(0,s.localizationKeys)("userProfile.phoneNumberPage.infoText"),colorScheme:"secondary"}),(0,r.Y)(a.Form.ControlRow,{elementId:m.id,children:(0,r.Y)(a.Form.PhoneInput,{...m.props,autoFocus:!0})}),(0,r.FD)(s.Flex,{justify:p?"between":"end",children:[p&&(0,r.Y)(s.Button,{variant:"ghost",localizationKey:(0,s.localizationKeys)("userProfile.mfaPhoneCodePage.backButton"),onClick:l}),(0,r.Y)(a.FormButtons,{submitLabel:(0,s.localizationKeys)("userProfile.formButtonPrimary__add"),isDisabled:!h,onReset:n})]})]})})},j=e=>{var t,o,i;const{title:n,onSuccess:l,resourceRef:c,onReset:d}=e;return(0,r.Y)(a.FormContainer,{headerTitle:n,headerSubtitle:(0,s.localizationKeys)("userProfile.phoneNumberPage.verifySubtitle",{identifier:null===(t=c.current)||void 0===t?void 0:t.phoneNumber}),children:(0,r.Y)(L,{nextStep:l,identification:c.current,identifier:null===(o=c.current)||void 0===o?void 0:o.phoneNumber,prepareVerification:null===(i=c.current)||void 0===i?void 0:i.prepareVerification,onReset:d})})},G=e=>{const{close:t}=(0,P.D5)();return(0,r.Y)(S,{onSuccess:t,onReset:t,...e})},Q=e=>{const{close:t}=(0,P.D5)();return(0,r.Y)(q,{onSuccess:t,onReset:t,...e})},X=()=>{const{user:e}=(0,f.Jd)();return(0,r.Y)(a.ProfileSection.Root,{centered:!1,title:(0,s.localizationKeys)("userProfile.start.phoneNumbersSection.title"),id:"phoneNumbers",children:(0,r.Y)(v.r.Root,{children:(0,r.FD)(a.ProfileSection.ItemList,{id:"phoneNumbers",children:[B(null==e?void 0:e.phoneNumbers,null==e?void 0:e.primaryPhoneNumberId).map((t=>(0,r.FD)(v.r.Root,{children:[(0,r.Y)(v.r.Closed,{value:"",children:(0,r.FD)(a.ProfileSection.Item,{id:"phoneNumbers",children:[(0,r.Y)(s.Box,{sx:{whiteSpace:"nowrap",overflow:"hidden"},children:(0,r.FD)(s.Flex,{gap:2,center:!0,children:[(0,r.Y)(s.Text,{sx:e=>({color:e.colors.$colorText}),children:(0,y.Om)(t.phoneNumber)}),(null==e?void 0:e.primaryPhoneNumberId)===t.id&&(0,r.Y)(s.Badge,{localizationKey:(0,s.localizationKeys)("badge__primary")}),"verified"!==t.verification.status&&(0,r.Y)(s.Badge,{localizationKey:(0,s.localizationKeys)("badge__unverified")})]})}),(0,r.Y)(Z,{phone:t})]})}),(0,r.Y)(v.r.Open,{value:"remove",children:(0,r.Y)(v.r.Card,{variant:"destructive",children:(0,r.Y)(G,{phoneId:t.id})})}),(0,r.Y)(v.r.Open,{value:"verify",children:(0,r.Y)(v.r.Card,{children:(0,r.Y)(Q,{phoneId:t.id})})})]},t.id))),(0,r.Y)(v.r.Trigger,{value:"add",children:(0,r.Y)(a.ProfileSection.ArrowButton,{id:"phoneNumbers",localizationKey:(0,s.localizationKeys)("userProfile.start.phoneNumbersSection.primaryButton")})}),(0,r.Y)(v.r.Open,{value:"add",children:(0,r.Y)(v.r.Card,{children:(0,r.Y)(Q,{})})})]})})})},Z=({phone:e})=>{const t=(0,a.useCardState)(),{open:o}=(0,P.D5)(),{user:i}=(0,f.Jd)();if(!i)return null;const n=i.primaryPhoneNumberId===e.id,l="verified"===e.verification.status,c=[n&&!l?{label:(0,s.localizationKeys)("userProfile.start.phoneNumbersSection.detailsAction__primary"),onClick:()=>o("verify")}:null,!n&&l?{label:(0,s.localizationKeys)("userProfile.start.phoneNumbersSection.detailsAction__nonPrimary"),onClick:()=>i.update({primaryPhoneNumberId:e.id}).catch((e=>(0,y.H4)(e,[],t.setError)))}:null,n||l?null:{label:(0,s.localizationKeys)("userProfile.start.phoneNumbersSection.detailsAction__unverified"),onClick:()=>o("verify")},{label:(0,s.localizationKeys)("userProfile.start.phoneNumbersSection.destructiveAction"),isDestructive:!0,onClick:()=>o("remove")}].filter((e=>null!==e));return(0,r.Y)(a.ThreeDotsMenu,{actions:c})};var ee=o(3965);const te=(0,a.withCardStateProvider)((e=>{const{onSuccess:t,onReset:o}=e,{user:i}=(0,f.Jd)();if(!i)return null;const{userSettings:l}=(0,n.useEnvironment)(),c=(0,a.useCardState)(),d=(0,y.tJ)("username",i.username||"",{type:"text",label:(0,s.localizationKeys)("formFieldLabel__username"),placeholder:(0,s.localizationKeys)("formFieldInputPlaceholder__username")}),u=l.attributes.username.required,m=(!u||d.value.length>1)&&i.username!==d.value;return(0,r.Y)(a.FormContainer,{headerTitle:i.username?(0,s.localizationKeys)("userProfile.usernamePage.title__update"):(0,s.localizationKeys)("userProfile.usernamePage.title__set"),children:(0,r.FD)(a.Form.Root,{onSubmit:async()=>{try{await i.update({username:d.value}),t()}catch(e){(0,y.H4)(e,[d],c.setError)}},children:[(0,r.Y)(a.Form.ControlRow,{elementId:d.id,children:(0,r.Y)(a.Form.PlainInput,{...d.props,autoFocus:!0,isRequired:u})}),(0,r.Y)(a.FormButtons,{isDisabled:!m,onReset:o})]})})})),oe=()=>{const{close:e}=(0,P.D5)();return(0,r.Y)(te,{onSuccess:e,onReset:e})},re=()=>{const{user:e}=(0,f.Jd)();return e?(0,r.Y)(a.ProfileSection.Root,{title:(0,s.localizationKeys)("userProfile.start.usernameSection.title"),id:"username",sx:{alignItems:"center",[ee.mqu.md]:{alignItems:"flex-start"}},children:(0,r.FD)(v.r.Root,{children:[(0,r.Y)(v.r.Closed,{value:"edit",children:(0,r.FD)(a.ProfileSection.Item,{id:"username",sx:{paddingLeft:e.username?void 0:"0"},children:[e.username&&(0,r.Y)(s.Text,{truncate:!0,sx:e=>({color:e.colors.$colorText}),children:e.username}),(0,r.Y)(v.r.Trigger,{value:"edit",children:(0,r.Y)(a.ProfileSection.Button,{id:"username",localizationKey:e.username?(0,s.localizationKeys)("userProfile.start.usernameSection.primaryButton__updateUsername"):(0,s.localizationKeys)("userProfile.start.usernameSection.primaryButton__setUsername")})})]})}),(0,r.Y)(v.r.Open,{value:"edit",children:(0,r.Y)(v.r.Card,{children:(0,r.Y)(oe,{})})})]})}):null},ie=e=>{const{user:t,...o}=e;return(0,r.Y)(a.AvatarUploader,{...o,title:(0,c.GQ)("userProfile.profilePage.imageFormTitle"),avatarPreview:(0,r.Y)(a.UserAvatar,{size:e=>e.sizes.$12,...t})})},ne=(0,a.withCardStateProvider)((e=>{const{onSuccess:t,onReset:o}=e,i=(0,a.useCardState)(),{user:l}=(0,f.Jd)();if(!l)return null;const{first_name:c,last_name:d}=(0,n.useEnvironment)().userSettings.attributes,u=c.enabled,m=d.enabled,p=l.firstName||"",v=l.lastName||"",P=(0,y.tJ)("firstName",l.firstName||"",{type:"text",label:(0,s.localizationKeys)("formFieldLabel__firstName"),placeholder:(0,s.localizationKeys)("formFieldInputPlaceholder__firstName"),isRequired:d.required}),g=(0,y.tJ)("lastName",l.lastName||"",{type:"text",label:(0,s.localizationKeys)("formFieldLabel__lastName"),placeholder:(0,s.localizationKeys)("formFieldInputPlaceholder__lastName"),isRequired:d.required}),Y=u&&P.value!==p||m&&g.value!==v,b=Y,S=u&&c.required||m&&d.required,z=S&&!!g.value&&!!P.value&&b,C=l.samlAccounts.some((e=>e.active));return(0,r.FD)(a.FormContainer,{headerTitle:(0,s.localizationKeys)("userProfile.profilePage.title"),children:[C&&(0,r.Y)(a.InformationBox,{message:(0,s.localizationKeys)("userProfile.profilePage.readonly")}),(0,r.FD)(a.Form.Root,{onSubmit:async e=>(e.preventDefault(),(Y?l.update({firstName:P.value,lastName:g.value}):Promise.resolve()).then(t).catch((e=>{(0,y.H4)(e,[P,g],i.setError)}))),sx:e=>({gap:e.space.$6}),children:[(0,r.Y)(ie,{user:l,onAvatarChange:e=>l.setProfileImage({file:e}).then((()=>{i.setIdle()})).catch((e=>(0,y.H4)(e,[],i.setError))),onAvatarRemove:(0,h.px)(l.imageUrl)?null:()=>{l.setProfileImage({file:null}).then((()=>{i.setIdle()})).catch((e=>(0,y.H4)(e,[],i.setError)))}}),(u||m)&&(0,r.FD)(a.Form.ControlRow,{elementId:"name",children:[u&&(0,r.Y)(a.Form.PlainInput,{...P.props,isDisabled:C,autoFocus:!0}),m&&(0,r.Y)(a.Form.PlainInput,{...g.props,isDisabled:C,autoFocus:!u})]}),(0,r.Y)(a.FormButtons,{isDisabled:S?!z:!b,onReset:o})]})]})})),se=()=>{const{close:e}=(0,P.D5)();return(0,r.Y)(ne,{onSuccess:e,onReset:e})},ae=()=>{const{user:e}=(0,f.Jd)();if(!e)return null;const{username:t,primaryEmailAddress:o,primaryPhoneNumber:i,...n}=e;return(0,r.Y)(a.ProfileSection.Root,{title:(0,s.localizationKeys)("userProfile.start.profileSection.title"),id:"profile",sx:{[ee.mqu.md]:{alignItems:"flex-start"}},children:(0,r.FD)(v.r.Root,{children:[(0,r.Y)(v.r.Closed,{value:"edit",children:(0,r.FD)(a.ProfileSection.Item,{id:"profile",children:[(0,r.Y)(a.UserPreview,{user:n,size:"lg",mainIdentifierVariant:"subtitle",sx:e=>({color:e.colors.$colorText})}),(0,r.Y)(v.r.Trigger,{value:"edit",children:(0,r.Y)(a.ProfileSection.Button,{id:"profile",localizationKey:(0,s.localizationKeys)("userProfile.start.profileSection.primaryButton")})})]})}),(0,r.Y)(v.r.Open,{value:"edit",children:(0,r.Y)(v.r.Card,{children:(0,r.Y)(se,{})})})]})})};var le=o(7199);const ce=(0,a.withCardStateProvider)((()=>{const e=(0,a.useCardState)(),{user:t}=(0,f.Jd)(),{strategies:o,strategyToDisplayData:i}=(0,g.kF)(),n=o.filter((e=>e.startsWith("web3"))),l=null==t?void 0:t.verifiedWeb3Wallets.map((e=>e.verification.strategy)),c=n.filter((e=>!l.includes(e)));return 0===c.length?null:(0,r.Y)(a.ProfileSection.ActionMenu,{id:"web3Wallets",triggerLocalizationKey:(0,s.localizationKeys)("userProfile.start.web3WalletsSection.primaryButton"),children:c.map((o=>(0,r.Y)(a.ProfileSection.ActionMenuItem,{id:i[o].id,onClick:()=>(async o=>{const r=o.replace("web3_","").replace("_signature","");try{e.setLoading(o);const i=await(0,le.hz)({provider:r});if(!t)throw new Error("user is not defined");let n=await t.createWeb3Wallet({web3Wallet:i});n=await n.prepareVerification({strategy:o});const s=n.verification.nonce,a=await(0,le.$t)({identifier:i,nonce:s,provider:r});await n.attemptVerification({signature:a}),e.setIdle()}catch(i){e.setIdle();const t=(0,y.hG)(i);t?e.setError(t.longMessage):(0,y.H4)(i,[],e.setError)}})(o),isLoading:e.loadingMetadata===o,isDisabled:e.isLoading,localizationKey:(0,s.localizationKeys)("userProfile.web3WalletPage.web3WalletButtonsBlockButton",{provider:i[o].name}),sx:e=>({justifyContent:"start",gap:e.space.$2}),leftIcon:(0,r.Y)(s.Image,{elementDescriptor:s.descriptors.providerIcon,elementId:s.descriptors.providerIcon.setId(i[o].id),isLoading:e.loadingMetadata===o,isDisabled:e.isLoading,src:i[o].iconUrl,alt:`Connect ${i[o].name}`,sx:e=>({width:e.sizes.$5})})},o)))})})),de=e=>{const{close:t}=(0,P.D5)();return(0,r.Y)(C,{onSuccess:t,onReset:t,...e})},ue=(0,a.withCardStateProvider)((()=>{const{user:e}=(0,f.Jd)(),t=(0,a.useCardState)(),{strategyToDisplayData:o}=(0,g.kF)();return(0,r.FD)(a.ProfileSection.Root,{title:(0,s.localizationKeys)("userProfile.start.web3WalletsSection.title"),id:"web3Wallets",children:[(0,r.Y)(a.Card.Alert,{children:t.error}),(0,r.FD)(v.r.Root,{children:[(0,r.Y)(a.ProfileSection.ItemList,{id:"web3Wallets",children:null==e?void 0:e.web3Wallets.map((t=>{const i=t.verification.strategy;return o[i]&&(0,r.FD)(v.r.Root,{children:[(0,r.Y)(v.r.Closed,{value:"",children:(0,r.FD)(a.ProfileSection.Item,{id:"web3Wallets",align:"start",children:[(0,r.FD)(s.Flex,{sx:e=>({alignItems:"center",gap:e.space.$2,width:"100%"}),children:[o[i].iconUrl&&(0,r.Y)(s.Image,{src:o[i].iconUrl,alt:o[i].name,sx:e=>({width:e.sizes.$4})}),(0,r.Y)(s.Box,{sx:{whiteSpace:"nowrap",overflow:"hidden"},children:(0,r.FD)(s.Flex,{gap:2,justify:"start",children:[(0,r.FD)(s.Text,{children:[o[i].name," (",(n=t.web3Wallet,n.length<=10?n:n.slice(0,6)+"..."+n.slice(-4)),")"]}),(null==e?void 0:e.primaryWeb3WalletId)===t.id&&(0,r.Y)(s.Badge,{localizationKey:(0,s.localizationKeys)("badge__primary")}),"verified"!==t.verification.status&&(0,r.Y)(s.Badge,{localizationKey:(0,s.localizationKeys)("badge__unverified")})]})})]}),(0,r.Y)(me,{})]},t.id)}),(0,r.Y)(v.r.Open,{value:"remove",children:(0,r.Y)(v.r.Card,{variant:"destructive",children:(0,r.Y)(de,{walletId:t.id})})})]},t.id);var n}))}),(0,r.Y)(ce,{})]})]})})),me=()=>{const{open:e}=(0,P.D5)(),t=[{label:(0,s.localizationKeys)("userProfile.start.web3WalletsSection.destructiveAction"),onClick:()=>e("remove")}].filter((e=>null!==e));return(0,r.Y)(a.ThreeDotsMenu,{actions:t})},fe=(0,a.withCardStateProvider)((()=>{const{attributes:e,saml:t,social:o}=(0,n.useEnvironment)().userSettings,i=(0,a.useCardState)(),{user:l}=(0,f.Jd)(),c=e.username.enabled,d=e.email_address.enabled,u=e.phone_number.enabled,m=o&&Object.values(o).filter((e=>e.enabled)).length>0,h=t&&t.enabled&&l&&l.samlAccounts.length>0,p=e.web3_wallet.enabled;return(0,r.Y)(s.Col,{elementDescriptor:s.descriptors.page,sx:e=>({gap:e.space.$8,color:e.colors.$colorText}),children:(0,r.FD)(s.Col,{elementDescriptor:s.descriptors.profilePage,elementId:s.descriptors.profilePage.setId("account"),children:[(0,r.Y)(a.Header.Root,{children:(0,r.Y)(a.Header.Title,{localizationKey:(0,s.localizationKeys)("userProfile.start.headerTitle__account"),sx:e=>({marginBottom:e.space.$4}),textVariant:"h2"})}),(0,r.Y)(a.Card.Alert,{children:i.error}),(0,r.Y)(ae,{}),c&&(0,r.Y)(re,{}),d&&(0,r.Y)(U,{}),u&&(0,r.Y)(X,{}),m&&(0,r.Y)(_,{}),h&&(0,r.Y)(H,{}),p&&(0,r.Y)(ue,{})]})})}));var he=o(7786);const pe=()=>{const{user:e}=(0,f.Jd)(),{session:t}=(0,f.wV)(),{data:o,isLoading:i}=(0,g.st)(null==e?void 0:e.getSessions,"user-sessions");return(0,r.Y)(a.ProfileSection.Root,{title:(0,s.localizationKeys)("userProfile.start.activeDevicesSection.title"),centered:!1,id:"activeDevices",children:(0,r.Y)(a.ProfileSection.ItemList,{id:"activeDevices",disableAnimation:!0,children:i?(0,r.Y)(a.FullHeightLoader,{}):null==o?void 0:o.sort((n=t.id,e=>e.id===n?-1:1)).map((e=>"active"!==e.status?null:(0,r.Y)(ve,{session:e},e.id)))})});var n},ve=({session:e})=>{var t;const o=(null===(t=(0,f.wV)().session)||void 0===t?void 0:t.id)===e.id,i=(0,g.mN)();return(0,r.FD)(a.ProfileSection.Item,{id:"activeDevices",elementDescriptor:s.descriptors.activeDeviceListItem,elementId:o?s.descriptors.activeDeviceListItem.setId("current"):void 0,sx:{alignItems:"flex-start"},children:[i.isLoading&&(0,r.Y)(a.FullHeightLoader,{}),!i.isLoading&&(0,r.FD)(r.FK,{children:[(0,r.Y)(Pe,{session:e}),!o&&(0,r.Y)(ge,{revoke:async()=>{if(!o&&e)return i.setLoading(),e.revoke().finally((()=>i.setIdle()))}})]})]})},Pe=e=>{const{session:t}=(0,f.wV)(),o=(null==t?void 0:t.id)===e.session.id,i=!!(null==t?void 0:t.actor),n=!!e.session.actor,{city:a,country:l,browserName:c,browserVersion:d,deviceType:u,ipAddress:m,isMobile:h}=e.session.latestActivity,p=u||(h?"Mobile device":"Desktop device"),v=`${c||""} ${d||""}`.trim()||"Web browser",P=[a||"",l||""].filter(Boolean).join(", ").trim()||null,{t:g}=(0,s.useLocalizations)();return(0,r.FD)(s.Flex,{elementDescriptor:s.descriptors.activeDevice,elementId:o?s.descriptors.activeDevice.setId("current"):void 0,sx:e=>({width:"100%",overflow:"hidden",gap:e.space.$4,[ee.mqu.sm]:{gap:e.space.$2}}),children:[(0,r.Y)(s.Flex,{sx:e=>({[ee.mqu.sm]:{padding:"0"},borderRadius:e.radii.$md}),children:(0,r.Y)(s.Icon,{elementDescriptor:s.descriptors.activeDeviceIcon,elementId:s.descriptors.activeDeviceIcon.setId(h?"mobile":"desktop"),icon:h?he.R2:he.rI,sx:e=>({"--cl-chassis-bottom":"#444444","--cl-chassis-back":"#343434","--cl-chassis-screen":"#575757","--cl-screen":"#000000",width:e.space.$8,height:e.space.$8})})}),(0,r.FD)(s.Col,{align:"start",gap:1,children:[(0,r.FD)(s.Flex,{center:!0,gap:2,children:[(0,r.Y)(s.Text,{children:p}),o&&(0,r.Y)(s.Badge,{localizationKey:(0,s.localizationKeys)("badge__thisDevice"),colorScheme:i?"danger":"primary"}),i&&!n&&(0,r.Y)(s.Badge,{localizationKey:(0,s.localizationKeys)("badge__userDevice")}),!o&&n&&(0,r.Y)(s.Badge,{localizationKey:(0,s.localizationKeys)("badge__otherImpersonatorDevice"),colorScheme:"danger"})]}),(0,r.Y)(s.Text,{colorScheme:"secondary",children:v}),(0,r.FD)(s.Text,{colorScheme:"secondary",children:[m," (",P,")"]}),(0,r.Y)(s.Text,{colorScheme:"secondary",children:g((0,y.T$)(e.session.lastActiveAt))})]})]})},ge=({revoke:e})=>{const t=[{label:(0,s.localizationKeys)("userProfile.start.activeDevicesSection.destructiveAction"),isDestructive:!0,onClick:e}].filter((e=>null!==e));return(0,r.Y)(a.ThreeDotsMenu,{actions:t})};var ye=o(9029);const Ye=(0,a.withCardStateProvider)((e=>{const{onReset:t}=e,o=(0,a.useCardState)(),{navigateAfterSignOut:i,navigateAfterMultiSessionSingleSignOutUrl:l}=(0,n.useSignOutContext)(),{user:c}=(0,f.Jd)(),{t:d}=(0,s.useLocalizations)(),{otherSessions:u}=(0,ye.z)({user:c}),{setActive:m}=(0,f.ho)(),h=(0,y.tJ)("deleteConfirmation","",{type:"text",label:(0,s.localizationKeys)("userProfile.deletePage.actionDescription"),isRequired:!0,placeholder:(0,s.localizationKeys)("formFieldInputPlaceholder__confirmDeletionUserAccount")}),p=h.value===(d((0,s.localizationKeys)("formFieldInputPlaceholder__confirmDeletionUserAccount"))||"Delete account");return(0,r.Y)(a.FormContainer,{headerTitle:(0,s.localizationKeys)("userProfile.deletePage.title"),sx:e=>({gap:e.space.$0x5}),children:(0,r.FD)(a.Form.Root,{onSubmit:async()=>{if(p)try{if(!c)throw Error("user is not defined");await c.delete();const e=0===u.length?i:l;return await m({session:null,beforeEmit:e})}catch(e){(0,y.H4)(e,[],o.setError)}},children:[(0,r.FD)(s.Col,{gap:1,children:[(0,r.Y)(s.Text,{colorScheme:"secondary",localizationKey:(0,s.localizationKeys)("userProfile.deletePage.messageLine1")}),(0,r.Y)(s.Text,{colorScheme:"danger",localizationKey:(0,s.localizationKeys)("userProfile.deletePage.messageLine2")})]}),(0,r.Y)(a.Form.ControlRow,{elementId:h.id,children:(0,r.Y)(a.Form.PlainInput,{...h.props,ignorePasswordManager:!0})}),(0,r.Y)(a.FormButtons,{submitLabel:(0,s.localizationKeys)("userProfile.deletePage.confirm"),colorScheme:"danger",isDisabled:!p,onReset:t})]})})})),be=()=>{const{close:e}=(0,P.D5)();return(0,r.Y)(Ye,{onSuccess:e,onReset:e})},Se=()=>(0,r.Y)(a.ProfileSection.Root,{title:(0,s.localizationKeys)("userProfile.start.dangerSection.title"),id:"danger",sx:{alignItems:"center",[ee.mqu.md]:{alignItems:"flex-start"}},children:(0,r.FD)(v.r.Root,{children:[(0,r.Y)(v.r.Closed,{value:"delete",children:(0,r.Y)(a.ProfileSection.Item,{id:"danger",sx:e=>({paddingLeft:e.space.$1}),children:(0,r.Y)(v.r.Trigger,{value:"delete",children:(0,r.Y)(a.ProfileSection.Button,{id:"danger",variant:"ghost",colorScheme:"danger",localizationKey:(0,s.localizationKeys)("userProfile.start.dangerSection.deleteAccountButton")})})})}),(0,r.Y)(v.r.Open,{value:"delete",children:(0,r.Y)(v.r.Card,{variant:"destructive",children:(0,r.Y)(be,{})})})]})});var ze=o(8740);const Ce=e=>{const{code:t}=e;return(0,r.Y)(s.Flex,{center:!0,sx:e=>({padding:`${e.space.$1} ${e.space.$4}`}),children:(0,r.Y)(s.Text,{children:t})})},Fe=e=>{const{subtitle:t,backupCodes:o}=e,{applicationName:i}=(0,n.useEnvironment)().displayConfig,{user:a}=(0,f.Jd)(),{print:l,printableProps:c}=(0,p.hH)(),{onCopy:d,hasCopied:u}=(0,g.iD)((null==o?void 0:o.join(","))||"");if(!a)return null;const m=(0,ze.Cm)(a);return o?(0,r.FD)(r.FK,{children:[(0,r.FD)(s.Col,{gap:1,children:[(0,r.Y)(s.Text,{localizationKey:(0,s.localizationKeys)("userProfile.backupCodePage.title__codelist"),variant:"subtitle"}),(0,r.Y)(s.Text,{localizationKey:t,variant:"caption",colorScheme:"secondary"})]}),(0,r.FD)(s.Box,{sx:e=>({borderWidth:e.borderWidths.$normal,borderStyle:e.borderStyles.$solid,borderColor:e.colors.$neutralAlpha100,borderRadius:e.radii.$lg}),children:[(0,r.Y)(s.Grid,{gap:2,sx:e=>({gridTemplateColumns:`repeat(2, minmax(${e.sizes.$12}, 1fr))`,padding:`${e.space.$4} ${e.space.$6}`}),children:o.map(((e,t)=>(0,r.Y)(Ce,{code:e},t)))}),(0,r.FD)(s.Grid,{sx:e=>({borderTopWidth:e.borderWidths.$normal,borderTopStyle:e.borderStyles.$solid,borderTopColor:e.colors.$neutralAlpha100,gridTemplateColumns:"repeat(3, minmax(0, 1fr))",">:not([hidden])~:not([hidden])":{borderRightWidth:"0px",borderLeftWidth:"1px",borderStyle:"solid",borderColor:e.colors.$neutralAlpha100},">:first-child":{borderBottomLeftRadius:e.radii.$lg},">:last-child":{borderBottomRightRadius:e.radii.$lg}}),children:[(0,r.Y)(s.Button,{variant:"ghost",sx:e=>({width:"100%",padding:`${e.space.$2} 0`,borderRadius:0}),onClick:()=>{const e=document.createElement("a"),t=new Blob([Ke(o,i,m)],{type:"text/plain"});e.href=URL.createObjectURL(t),e.download=`${i}_backup_codes.txt`,document.body.appendChild(e),e.click()},children:(0,r.Y)(s.Icon,{icon:he.f5})}),(0,r.Y)(s.Button,{variant:"ghost",sx:e=>({width:"100%",padding:`${e.space.$2} 0`,borderRadius:0}),onClick:l,children:(0,r.Y)(s.Icon,{icon:he.aS})}),(0,r.Y)(s.Button,{variant:"ghost",onClick:d,sx:e=>({width:"100%",padding:`${e.space.$2} 0`,borderRadius:0}),children:(0,r.Y)(s.Icon,{icon:u?he.Jl:he.QR})})]})]}),(0,r.FD)(p.LS,{...c,children:[(0,r.FD)(s.Heading,{children:["Your backup codes for ",i," account ",m,":"]}),(0,r.Y)(s.Col,{gap:2,children:o.map(((e,t)=>(0,r.Y)(Ce,{code:e},t)))})]})]}):null};function Ke(e,t,o){return`These are your backup codes for ${t} account ${o}.\nStore them securely and keep them secret. Each code can only be used once.\n\n${null==e?void 0:e.join("\n")}`}const Re=(0,a.withCardStateProvider)((e=>{const{onSuccess:t}=e,{user:o}=(0,f.Jd)(),n=(0,a.useCardState)(),[l,c]=i.useState(void 0);return i.useEffect((()=>{l||null==o||o.createBackupCode().then((e=>c(e))).catch((e=>(0,y.H4)(e,[],n.setError)))}),[]),n.error?(0,r.Y)(a.FormContainer,{headerTitle:(0,s.localizationKeys)("userProfile.backupCodePage.title")}):(0,r.Y)(a.FormContainer,{headerTitle:(0,s.localizationKeys)("userProfile.backupCodePage.title"),children:l?(0,r.FD)(r.FK,{children:[(0,r.Y)(s.Text,{localizationKey:(0,s.localizationKeys)("userProfile.backupCodePage.successMessage")}),(0,r.Y)(Fe,{subtitle:(0,s.localizationKeys)("userProfile.backupCodePage.subtitle__codelist"),backupCodes:l.codes}),(0,r.Y)(a.FormButtonContainer,{children:(0,r.Y)(s.Button,{autoFocus:!0,onClick:t,localizationKey:(0,s.localizationKeys)("userProfile.formButtonPrimary__finish"),elementDescriptor:s.descriptors.formButtonPrimary})})]}):(0,r.Y)(a.FullHeightLoader,{})})})),De=(0,a.withCardStateProvider)((e=>{const{onSuccess:t,onReset:o}=e,i=(0,p.Xi)();return(0,r.FD)(p.sQ,{...i.props,children:[(0,r.Y)(xe,{onContinue:i.nextStep}),(0,r.Y)(Re,{onSuccess:t,onReset:o})]})})),xe=e=>{const{onContinue:t}=e,{close:o}=(0,P.D5)();return(0,r.FD)(a.FormContainer,{headerTitle:(0,s.localizationKeys)("userProfile.backupCodePage.title"),children:[(0,r.Y)(s.Text,{localizationKey:(0,s.localizationKeys)("userProfile.backupCodePage.infoText1")}),(0,r.Y)(s.Text,{localizationKey:(0,s.localizationKeys)("userProfile.backupCodePage.infoText2")}),(0,r.FD)(a.FormButtonContainer,{sx:{marginTop:0},children:[(0,r.Y)(s.Button,{textVariant:"buttonSmall",onClick:t,localizationKey:(0,s.localizationKeys)("userProfile.formButtonPrimary__finish"),elementDescriptor:s.descriptors.formButtonPrimary}),(0,r.Y)(s.Button,{variant:"ghost",onClick:o,localizationKey:(0,s.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:s.descriptors.formButtonReset})]})]})},_e=(0,a.withCardStateProvider)((e=>{var t;const{onReset:o,onSuccess:l}=e,c=i.useRef(),d=(0,p.Xi)({defaultStep:2}),u=(0,n.useEnvironment)().userSettings.attributes.backup_code.enabled;return(0,r.FD)(p.sQ,{...d.props,children:[(0,r.Y)(V,{title:(0,s.localizationKeys)("userProfile.phoneNumberPage.title"),resourceRef:c,onSuccess:d.nextStep,onUseExistingNumberClick:()=>d.goToStep(2),onReset:o}),(0,r.Y)(j,{title:(0,s.localizationKeys)("userProfile.mfaPhoneCodePage.title"),resourceRef:c,onSuccess:d.nextStep,onReset:()=>d.goToStep(2)}),(0,r.Y)(we,{onSuccess:u?d.nextStep:l,onReset:o,onAddPhoneClick:()=>d.goToStep(0),onUnverifiedPhoneClick:e=>{c.current=e,d.goToStep(1)},title:(0,s.localizationKeys)("userProfile.mfaPhoneCodePage.title"),resourceRef:c}),u&&(0,r.Y)(a.SuccessPage,{title:(0,s.localizationKeys)("userProfile.mfaPhoneCodePage.successTitle"),text:[(0,s.localizationKeys)("userProfile.mfaPhoneCodePage.successMessage1"),(0,s.localizationKeys)("userProfile.mfaPhoneCodePage.successMessage2")],onFinish:o,contents:(0,r.Y)(Fe,{backupCodes:null===(t=c.current)||void 0===t?void 0:t.backupCodes})})]})})),we=e=>{const{onSuccess:t,onReset:o,title:i,onAddPhoneClick:n,onUnverifiedPhoneClick:l,resourceRef:c}=e,d=(0,a.useCardState)(),{user:u}=(0,f.Jd)();if(!u)return null;const m=u.phoneNumbers.filter((e=>!e.reservedForSecondFactor));return(0,r.FD)(a.FormContainer,{headerTitle:i,gap:1,children:[(0,r.Y)(s.Text,{localizationKey:(0,s.localizationKeys)(m.length?"userProfile.mfaPhoneCodePage.subtitle__availablePhoneNumbers":"userProfile.mfaPhoneCodePage.subtitle__unavailablePhoneNumbers"),colorScheme:"secondary"}),m.length>0&&(0,r.Y)(s.Col,{gap:2,children:m.map((e=>{const{country:o}=(0,y.Mz)(e.phoneNumber),i=(0,y.Om)(e.phoneNumber);return(0,r.FD)(s.Button,{variant:"outline",colorScheme:"neutral",sx:{justifyContent:"start"},onClick:()=>(async e=>{if("verified"!==e.verification.status)return l(e);d.setLoading(e.id);try{await e.setReservedForSecondFactor({reserved:!0}).then((()=>{c.current=e,t()}))}catch(o){(0,y.H4)(o,[],d.setError)}finally{d.setIdle()}})(e),isLoading:d.loadingMetadata===e.id,isDisabled:d.isLoading,children:[o.iso.toUpperCase()," ",i]},e.id)}))}),(0,r.FD)(a.FormButtonContainer,{sx:{flexDirection:"row",justifyContent:"space-between"},children:[(0,r.Y)(a.IconButton,{variant:"ghost","aria-label":"Add phone number",icon:(0,r.Y)(s.Icon,{icon:he.FW,sx:e=>({marginRight:e.space.$2})}),localizationKey:(0,s.localizationKeys)("userProfile.mfaPhoneCodePage.primaryButton__addPhoneNumber"),onClick:n}),(0,r.Y)(s.Button,{variant:"ghost",localizationKey:(0,s.localizationKeys)("userProfile.formButtonReset"),onClick:o})]})]})},Te=(0,a.withCardStateProvider)((e=>{const{title:t,onSuccess:o,onReset:n}=e,{user:l}=(0,f.Jd)(),c=(0,a.useCardState)(),[d,u]=i.useState(void 0),[m,h]=i.useState("qr");return i.useEffect((()=>{null==l||l.createTOTP().then((e=>u(e))).catch((e=>(0,y.H4)(e,[],c.setError)))}),[]),c.error?(0,r.Y)(a.FormContainer,{headerTitle:t}):(0,r.FD)(a.FormContainer,{headerTitle:t,headerSubtitle:"qr"==m?(0,s.localizationKeys)("userProfile.mfaTOTPPage.authenticatorApp.infoText__ableToScan"):(0,s.localizationKeys)("userProfile.mfaTOTPPage.authenticatorApp.infoText__unableToScan"),children:[!d&&(0,r.Y)(a.FullHeightLoader,{}),d&&(0,r.FD)(r.FK,{children:[(0,r.FD)(s.Col,{gap:4,children:["qr"==m&&(0,r.Y)(p.rg,{justify:"center",url:d.uri||""}),"uri"==m&&(0,r.FD)(r.FK,{children:[(0,r.Y)(s.Text,{colorScheme:"secondary",localizationKey:(0,s.localizationKeys)("userProfile.mfaTOTPPage.authenticatorApp.inputLabel__unableToScan1")}),(0,r.Y)(a.ClipboardInput,{value:d.secret}),(0,r.Y)(s.Text,{colorScheme:"secondary",localizationKey:(0,s.localizationKeys)("userProfile.mfaTOTPPage.authenticatorApp.inputLabel__unableToScan2")}),(0,r.Y)(a.ClipboardInput,{value:d.uri})]})]}),(0,r.FD)(s.Flex,{justify:"between",align:"center",sx:{width:"100%"},children:["qr"==m&&(0,r.Y)(s.Button,{variant:"link",textVariant:"buttonLarge",onClick:()=>h("uri"),localizationKey:(0,s.localizationKeys)("userProfile.mfaTOTPPage.authenticatorApp.buttonUnableToScan__nonPrimary")}),"uri"==m&&(0,r.Y)(s.Button,{variant:"link",textVariant:"buttonLarge",onClick:()=>h("qr"),localizationKey:(0,s.localizationKeys)("userProfile.mfaTOTPPage.authenticatorApp.buttonAbleToScan__nonPrimary")}),(0,r.FD)(a.FormButtonContainer,{children:[(0,r.Y)(s.Button,{onClick:o,localizationKey:(0,s.localizationKeys)("userProfile.formButtonPrimary__continue"),elementDescriptor:s.descriptors.formButtonPrimary}),(0,r.Y)(s.Button,{variant:"ghost",onClick:n,localizationKey:(0,s.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:s.descriptors.formButtonReset})]})]})]})]})})),ke=(0,a.withCardStateProvider)((e=>{const{onSuccess:t,onReset:o,resourceRef:i}=e,{user:n}=(0,f.Jd)(),l=(0,a.useFieldOTP)({onCodeEntryFinished:(e,t,o)=>{null==n||n.verifyTOTP({code:e}).then((e=>t(e))).catch(o)},onResolve:e=>{i.current=e,t()}});return(0,r.FD)(a.FormContainer,{headerTitle:(0,s.localizationKeys)("userProfile.mfaTOTPPage.title"),children:[(0,r.Y)(s.Col,{children:(0,r.Y)(a.Form.OTPInput,{...l,label:(0,s.localizationKeys)("userProfile.mfaTOTPPage.verifyTitle"),description:(0,s.localizationKeys)("userProfile.mfaTOTPPage.verifySubtitle")})}),(0,r.Y)(a.FormButtonContainer,{sx:{marginTop:0},children:(0,r.Y)(s.Button,{onClick:o,variant:"ghost",isDisabled:l.isLoading,localizationKey:(0,s.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:s.descriptors.formButtonReset})})]})})),Ie=(0,a.withCardStateProvider)((e=>{var t;const{onReset:o}=e,n=(0,p.Xi)(),l=i.useRef();return(0,r.FD)(p.sQ,{...n.props,children:[(0,r.Y)(Te,{title:(0,s.localizationKeys)("userProfile.mfaTOTPPage.title"),onSuccess:n.nextStep,onReset:o}),(0,r.Y)(ke,{onSuccess:n.nextStep,onReset:o,resourceRef:l}),(0,r.Y)(a.SuccessPage,{title:(0,s.localizationKeys)("userProfile.mfaTOTPPage.title"),text:(0,s.localizationKeys)("userProfile.mfaTOTPPage.successMessage"),onFinish:o,contents:(0,r.Y)(Fe,{subtitle:(0,s.localizationKeys)("userProfile.backupCodePage.successSubtitle"),backupCodes:null===(t=l.current)||void 0===t?void 0:t.backupCodes})})]})})),Ae=(0,a.withCardStateProvider)((e=>{const{onSuccess:t,onReset:o,selectedStrategy:l}=e,c=(0,a.useCardState)(),{userSettings:{attributes:d}}=(0,n.useEnvironment)(),{user:u}=(0,f.Jd)();if(!u)return null;const m=(0,s.localizationKeys)("userProfile.mfaPage.title"),h=i.useMemo((()=>A(d,u)),[]);return i.useEffect((()=>{0===h.length&&c.setError("There are no second factors available to add")}),[]),c.error?(0,r.Y)(a.FormContainer,{headerTitle:m}):0!==h.length||l?(0,r.Y)(Be,{onSuccess:t,onReset:o,method:l||h[0]}):null})),Be=e=>{const{method:t,onSuccess:o,onReset:i}=e;switch(t){case"phone_code":return(0,r.Y)(_e,{onSuccess:o,onReset:i});case"totp":return(0,r.Y)(Ie,{onSuccess:o,onReset:i});case"backup_code":return(0,r.Y)(De,{onSuccess:o,onReset:i});default:return null}},Le=()=>{const{close:e}=(0,P.D5)();return(0,r.Y)(K,{onSuccess:e,onReset:e})},$e=e=>{const{close:t}=(0,P.D5)();return(0,r.Y)(F,{onSuccess:t,onReset:t,...e})},Ee=()=>{const{close:e}=(0,P.D5)();return(0,r.Y)(Re,{onSuccess:e,onReset:e})},Ne=e=>{const{close:t}=(0,P.D5)();return(0,r.Y)(Ae,{onSuccess:t,onReset:t,selectedStrategy:e.selectedStrategy})},Oe=()=>{const{userSettings:{attributes:e}}=(0,n.useEnvironment)(),{user:t}=(0,f.Jd)();if(!t)return null;const o=I(e),i=A(e,t),l=o.includes("totp")&&t.totpEnabled,c=o.includes("backup_code")&&t.backupCodeEnabled,d=t.phoneNumbers.filter((e=>"verified"===e.verification.status)).filter((e=>e.reservedForSecondFactor)).sort(k);return(0,r.Y)(a.ProfileSection.Root,{title:(0,s.localizationKeys)("userProfile.start.mfaSection.title"),centered:!1,id:"mfa",children:(0,r.Y)(v.r.Root,{children:(0,r.FD)(a.ProfileSection.ItemList,{id:"mfa",children:[l&&(0,r.FD)(v.r.Root,{children:[(0,r.FD)(a.ProfileSection.Item,{id:"mfa",hoverable:!0,children:[(0,r.FD)(s.Flex,{sx:e=>({gap:e.space.$2,alignItems:"center"}),children:[(0,r.Y)(s.Icon,{icon:he.c6,sx:e=>({color:e.colors.$neutralAlpha700})}),(0,r.Y)(s.Text,{localizationKey:(0,s.localizationKeys)("userProfile.start.mfaSection.totp.headerTitle")}),(0,r.Y)(s.Badge,{localizationKey:(0,s.localizationKeys)("badge__default")})]}),(0,r.Y)(Ue,{})]}),(0,r.Y)(v.r.Open,{value:"remove",children:(0,r.Y)(v.r.Card,{variant:"destructive",children:(0,r.Y)(Le,{})})})]}),o.includes("phone_code")&&d.map((e=>{const t=!l&&e.defaultSecondFactor;return(0,r.FD)(v.r.Root,{children:[(0,r.FD)(a.ProfileSection.Item,{id:"mfa",hoverable:!0,children:[(0,r.FD)(s.Flex,{sx:e=>({gap:e.space.$2,alignItems:"center"}),children:[(0,r.Y)(s.Icon,{icon:he.fq,sx:e=>({color:e.colors.$neutralAlpha700})}),(0,r.FD)(s.Text,{children:["SMS Code ",(0,r.Y)(a.FormattedPhoneNumberText,{value:e.phoneNumber})]}),t&&(0,r.Y)(s.Badge,{localizationKey:(0,s.localizationKeys)("badge__default")})]}),(0,r.Y)(Me,{phone:e,showTOTP:l})]}),(0,r.Y)(v.r.Open,{value:"remove",children:(0,r.Y)(v.r.Card,{variant:"destructive",children:(0,r.Y)($e,{phoneId:e.id})})})]},e.id)})),c&&(0,r.FD)(v.r.Root,{children:[(0,r.FD)(a.ProfileSection.Item,{id:"mfa",hoverable:!0,children:[(0,r.FD)(s.Flex,{sx:e=>({gap:e.space.$2,alignItems:"center"}),children:[(0,r.Y)(s.Icon,{icon:he.G6,sx:e=>({color:e.colors.$neutralAlpha700})}),(0,r.Y)(s.Text,{localizationKey:(0,s.localizationKeys)("userProfile.start.mfaSection.backupCodes.headerTitle")})]}),(0,r.Y)(Je,{})]}),(0,r.Y)(v.r.Open,{value:"regenerate",children:(0,r.Y)(v.r.Card,{children:(0,r.Y)(Ee,{})})})]}),(0,r.Y)(We,{secondFactorsAvailableToAdd:i})]})})})},Me=({phone:e,showTOTP:t})=>{const{open:o}=(0,P.D5)(),i=(0,a.useCardState)(),n=[t?null:{label:(0,s.localizationKeys)("userProfile.start.mfaSection.phoneCode.actionLabel__setDefault"),onClick:()=>e.makeDefaultSecondFactor().catch((e=>(0,y.H4)(e,[],i.setError))),isDisabled:e.defaultSecondFactor},{label:(0,s.localizationKeys)("userProfile.start.mfaSection.phoneCode.destructiveActionLabel"),isDestructive:!0,onClick:()=>o("remove")}].filter((e=>null!==e));return(0,r.Y)(a.ThreeDotsMenu,{actions:n})},Je=()=>{const{open:e}=(0,P.D5)(),t=[{label:(0,s.localizationKeys)("userProfile.start.mfaSection.backupCodes.actionLabel__regenerate"),onClick:()=>e("regenerate")}].filter((e=>null!==e));return(0,r.Y)(a.ThreeDotsMenu,{actions:t})},Ue=()=>{const{open:e}=(0,P.D5)(),t=[{label:(0,s.localizationKeys)("userProfile.start.mfaSection.totp.destructiveActionTitle"),isDestructive:!0,onClick:()=>e("remove")}].filter((e=>null!==e));return(0,r.Y)(a.ThreeDotsMenu,{actions:t})},We=e=>{const{open:t}=(0,P.D5)(),{secondFactorsAvailableToAdd:o}=e,[n,l]=(0,i.useState)(),c=i.useMemo((()=>o.map((e=>"phone_code"===e?{icon:he.fq,text:"SMS code",key:"phone_code"}:"totp"===e?{icon:he.c6,text:"Authenticator application",key:"totp"}:"backup_code"===e?{icon:he.G6,text:"Backup code",key:"backup_code"}:null)).filter((e=>null!==e))),[o]);return(0,r.FD)(r.FK,{children:[o.length>0&&(0,r.Y)(v.r.Closed,{value:"multi-factor",children:(0,r.Y)(a.ProfileSection.ActionMenu,{id:"mfa",triggerLocalizationKey:(0,s.localizationKeys)("userProfile.start.mfaSection.primaryButton"),children:c.map((e=>e&&(0,r.Y)(a.ProfileSection.ActionMenuItem,{id:e.key,localizationKey:e.text,leftIcon:e.icon,onClick:()=>{l(e.key),t("multi-factor")}},e.key)))})}),(0,r.Y)(v.r.Open,{value:"multi-factor",children:(0,r.Y)(v.r.Card,{children:n&&(0,r.Y)(Ne,{selectedStrategy:n})})})]})},He=e=>{const{close:t}=(0,P.D5)();return(0,r.Y)(R,{onSuccess:t,onReset:t,...e})},qe=e=>{const{close:t}=(0,P.D5)();return(0,r.Y)(Ve,{onSuccess:t,onReset:t,passkey:e.passkey})},Ve=(0,a.withCardStateProvider)((e=>{const{onSuccess:t,onReset:o,passkey:i}=e,n=(0,a.useCardState)(),l=(0,y.tJ)("passkeyName",i.name||"",{type:"text",label:(0,s.localizationKeys)("formFieldLabel__passkeyName"),isRequired:!0}),c=l.value.length>1&&i.name!==l.value;return(0,r.Y)(a.FormContainer,{headerTitle:(0,s.localizationKeys)("userProfile.passkeyScreen.title__rename"),headerSubtitle:(0,s.localizationKeys)("userProfile.passkeyScreen.subtitle__rename"),children:(0,r.FD)(a.Form.Root,{onSubmit:async e=>(e.preventDefault(),i.update({name:l.value}).then(t).catch((e=>(0,y.H4)(e,[l],n.setError)))),children:[(0,r.Y)(a.Form.ControlRow,{elementId:l.id,children:(0,r.Y)(a.Form.PlainInput,{...l.props,autoComplete:"off"})}),(0,r.Y)(a.FormButtons,{submitLabel:(0,s.localizationKeys)("userProfile.formButtonPrimary__save"),isDisabled:!c,onReset:o})]})})})),je=()=>{const{user:e}=(0,f.Jd)();return e?(0,r.Y)(a.ProfileSection.Root,{title:(0,s.localizationKeys)("userProfile.start.passkeysSection.title"),centered:!1,id:"passkeys",children:(0,r.FD)(a.ProfileSection.ItemList,{id:"passkeys",children:[e.passkeys.map((e=>(0,r.FD)(v.r.Root,{children:[(0,r.Y)(Ge,{...e},e.id),(0,r.Y)(v.r.Open,{value:"remove",children:(0,r.Y)(v.r.Card,{variant:"destructive",children:(0,r.Y)(He,{passkey:e})})}),(0,r.Y)(v.r.Open,{value:"rename",children:(0,r.Y)(v.r.Card,{children:(0,r.Y)(qe,{passkey:e})})})]},e.id))),(0,r.Y)(Ze,{})]})}):null},Ge=e=>(0,r.FD)(a.ProfileSection.Item,{id:"passkeys",hoverable:!0,sx:{alignItems:"flex-start"},children:[(0,r.Y)(Qe,{...e}),(0,r.Y)(Xe,{})]}),Qe=e=>{const{name:t,createdAt:o,lastUsedAt:i}=e,{t:n}=(0,s.useLocalizations)();return(0,r.Y)(s.Flex,{sx:e=>({width:"100%",overflow:"hidden",gap:e.space.$4,[ee.mqu.sm]:{gap:e.space.$2}}),children:(0,r.FD)(s.Col,{align:"start",gap:1,children:[(0,r.Y)(s.Text,{children:t}),(0,r.FD)(s.Text,{colorScheme:"secondary",children:["Created: ",n((0,y.T$)(o))]}),i&&(0,r.FD)(s.Text,{colorScheme:"secondary",children:["Last used: ",n((0,y.T$)(i))]})]})})},Xe=()=>{const{open:e}=(0,P.D5)(),t=[{label:(0,s.localizationKeys)("userProfile.start.passkeysSection.menuAction__rename"),onClick:()=>e("rename")},{label:(0,s.localizationKeys)("userProfile.start.passkeysSection.menuAction__destructive"),isDestructive:!0,onClick:()=>e("remove")}];return(0,r.Y)(a.ThreeDotsMenu,{actions:t})},Ze=()=>{const e=(0,a.useCardState)(),{isSatellite:t}=(0,f.ho)(),{user:o}=(0,f.Jd)();return t?null:(0,r.Y)(a.ProfileSection.ArrowButton,{id:"passkeys",localizationKey:"Add a passkey",onClick:async()=>{try{await(null==o?void 0:o.createPasskey())}catch(t){(0,y.H4)(t,[],e.setError)}}})},et=(e,t)=>{const o=[];return e?o.push((0,s.localizationKeys)("userProfile.passwordPage.successMessage__update")):o.push((0,s.localizationKeys)("userProfile.passwordPage.successMessage__set")),t&&o.push((0,s.localizationKeys)("userProfile.passwordPage.successMessage__signOutOfOtherSessions")),o},tt=(0,a.withCardStateProvider)((e=>{const{onSuccess:t,onReset:o}=e,{user:l}=(0,f.Jd)();if(!l)return null;const{session:c}=(0,f.wV)(),d=l.passwordEnabled?(0,s.localizationKeys)("userProfile.passwordPage.title__update"):(0,s.localizationKeys)("userProfile.passwordPage.title__set"),u=(0,a.useCardState)(),m=l.samlAccounts.some((e=>e.active)),h=(0,i.useRef)({title:(0,s.localizationKeys)("userProfile.passwordPage.title__set")}),p=(0,y.tJ)("currentPassword","",{type:"password",label:(0,s.localizationKeys)("formFieldLabel__currentPassword"),isRequired:!0}),{userSettings:{passwordSettings:v}}=(0,n.useEnvironment)(),P=(0,y.tJ)("newPassword","",{type:"password",label:(0,s.localizationKeys)("formFieldLabel__newPassword"),isRequired:!0,validatePassword:!0,buildErrorMessage:e=>(0,y.C5)(e,{t:C,locale:F,passwordSettings:v})}),Y=(0,y.tJ)("confirmPassword","",{type:"password",label:(0,s.localizationKeys)("formFieldLabel__confirmPassword"),isRequired:!0}),b=(0,y.tJ)("signOutOfOtherSessions","",{type:"checkbox",label:(0,s.localizationKeys)("formFieldLabel__signOutOfOtherSessions"),defaultChecked:!0}),{setConfirmPasswordFeedback:S,isPasswordMatch:z}=(0,g.Zg)({passwordField:P,confirmPasswordField:Y}),{t:C,locale:F}=(0,s.useLocalizations)(),K=(l.passwordEnabled?p.value&&z:z)&&P.value&&Y.value;return(0,r.FD)(a.FormContainer,{headerTitle:d,children:[m&&(0,r.Y)(a.InformationBox,{message:(0,s.localizationKeys)("userProfile.passwordPage.readonly")}),(0,r.FD)(a.Form.Root,{onSubmit:async()=>{const e={newPassword:P.value,signOutOfOtherSessions:b.checked,currentPassword:l.passwordEnabled?p.value:void 0};try{h.current={title:l.passwordEnabled?(0,s.localizationKeys)("userProfile.passwordPage.title__update"):(0,s.localizationKeys)("userProfile.passwordPage.title__set"),text:et(l.passwordEnabled,!!b.checked)},await l.updatePassword(e),t()}catch(o){(0,y.H4)(o,[p,P,Y],u.setError)}},onBlur:()=>{P.value&&S(Y.value)},children:[(0,r.Y)("input",{readOnly:!0,"data-testid":"hidden-identifier",id:"identifier-field",name:"identifier",value:(null==c?void 0:c.publicUserData.identifier)||"",style:{display:"none"}}),l.passwordEnabled&&(0,r.Y)(a.Form.ControlRow,{elementId:p.id,children:(0,r.Y)(a.Form.PasswordInput,{...p.props,minLength:6,isRequired:!0,autoFocus:!0,isDisabled:m})}),(0,r.Y)(a.Form.ControlRow,{elementId:P.id,children:(0,r.Y)(a.Form.PasswordInput,{...P.props,minLength:6,isRequired:!0,autoFocus:!l.passwordEnabled,isDisabled:m})}),(0,r.Y)(a.Form.ControlRow,{elementId:Y.id,children:(0,r.Y)(a.Form.PasswordInput,{...Y.props,onChange:e=>(e.target.value&&S(e.target.value),Y.props.onChange(e)),isRequired:!0,isDisabled:m})}),(0,r.Y)(a.Form.ControlRow,{elementId:b.id,children:(0,r.Y)(a.Form.Checkbox,{...b.props,description:(0,s.localizationKeys)("userProfile.passwordPage.checkboxInfoText__signOutOfOtherSessions"),isDisabled:m})}),m?(0,r.Y)(a.FormButtonContainer,{children:(0,r.Y)(a.Form.ResetButton,{localizationKey:(0,s.localizationKeys)("userProfile.formButtonReset"),block:!1,onClick:o})}):(0,r.Y)(a.FormButtons,{isDisabled:!K,onReset:o})]})]})})),ot=()=>{const{close:e}=(0,P.D5)();return(0,r.Y)(tt,{onSuccess:e,onReset:e})},rt=()=>{const{user:e}=(0,f.Jd)();if(!e)return null;const{passwordEnabled:t}=e;return(0,r.Y)(a.ProfileSection.Root,{centered:!1,title:(0,s.localizationKeys)("userProfile.start.passwordSection.title"),id:"password",children:(0,r.FD)(v.r.Root,{children:[(0,r.Y)(v.r.Closed,{value:"edit",children:(0,r.FD)(a.ProfileSection.Item,{id:"password",sx:e=>({paddingLeft:t?void 0:"0",paddingTop:e.space.$0x25,paddingBottom:e.space.$0x25}),children:[t&&(0,r.Y)(s.Text,{variant:"h2",children:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"}),(0,r.Y)(v.r.Trigger,{value:"edit",children:(0,r.Y)(a.ProfileSection.Button,{id:"password",localizationKey:t?(0,s.localizationKeys)("userProfile.start.passwordSection.primaryButton__updatePassword"):(0,s.localizationKeys)("userProfile.start.passwordSection.primaryButton__setPassword")})})]})}),(0,r.Y)(v.r.Open,{value:"edit",children:(0,r.Y)(v.r.Card,{children:(0,r.Y)(ot,{})})})]})})},it=(0,a.withCardStateProvider)((()=>{const{attributes:e,instanceIsPasswordBased:t}=(0,n.useEnvironment)().userSettings,o=(0,a.useCardState)(),{user:i}=(0,f.Jd)(),l=t,c=e.passkey.enabled,d=I(e).length>0,u=null==i?void 0:i.deleteSelfEnabled;return(0,r.Y)(s.Col,{elementDescriptor:s.descriptors.page,sx:e=>({gap:e.space.$8}),children:(0,r.FD)(s.Col,{elementDescriptor:s.descriptors.profilePage,elementId:s.descriptors.profilePage.setId("security"),children:[(0,r.Y)(a.Header.Root,{children:(0,r.Y)(a.Header.Title,{localizationKey:(0,s.localizationKeys)("userProfile.start.headerTitle__security"),sx:e=>({marginBottom:e.space.$4}),textVariant:"h2"})}),(0,r.Y)(a.Card.Alert,{children:o.error}),l&&(0,r.Y)(rt,{}),c&&(0,r.Y)(je,{}),d&&(0,r.Y)(Oe,{}),(0,r.Y)(pe,{}),u&&(0,r.Y)(Se,{})]})})})),nt=()=>{var e;const{pages:t}=(0,n.useUserProfileContext)(),o=t.routes[0].id===m.j2.ACCOUNT,i=t.routes[0].id===m.j2.SECURITY,s=null===(e=t.contents)||void 0===e?void 0:e.map(((e,t)=>{const n=!o&&!i&&0===t;return(0,r.Y)(l.Route,{index:n,path:n?void 0:e.url,children:(0,r.Y)(u.H,{mount:e.mount,unmount:e.unmount})},`custom-page-${e.url}`)}));return(0,r.FD)(l.Switch,{children:[s,(0,r.FD)(l.Route,{children:[(0,r.Y)(l.Route,{path:o?void 0:"account",children:(0,r.Y)(l.Switch,{children:(0,r.Y)(l.Route,{index:!0,children:(0,r.Y)(fe,{})})})}),(0,r.Y)(l.Route,{path:i?void 0:"security",children:(0,r.Y)(l.Switch,{children:(0,r.Y)(l.Route,{index:!0,children:(0,r.Y)(it,{})})})})]})]})},st=(0,n.withCoreUserGuard)((()=>{const e=i.useRef(null);return(0,r.Y)(a.ProfileCard.Root,{children:(0,r.FD)(d,{contentRef:e,children:[(0,r.Y)(a.NavbarMenuButtonRow,{navbarTitleLocalizationKey:(0,s.localizationKeys)("userProfile.navbar.title")}),(0,r.Y)(a.ProfileCard.Content,{contentRef:e,children:(0,r.Y)(nt,{})})]})})})),at=(0,a.withCardStateProvider)((e=>(0,r.Y)(s.Flow.Root,{flow:"userProfile",children:(0,r.Y)(s.Flow.Part,{children:(0,r.FD)(l.Switch,{children:[(0,r.Y)(l.Route,{path:"verify",children:(0,r.Y)(N,{})}),(0,r.Y)(l.Route,{children:(0,r.Y)(st,{})})]})})}))),lt=e=>{const t={...e,routing:"virtual",componentName:"UserProfile",mode:"modal"};return(0,r.Y)(l.Route,{path:"user",children:(0,r.Y)(n.ComponentContext.Provider,{value:t,children:(0,r.Y)("div",{children:(0,r.Y)(at,{...t})})})})}}}]);